#!/usr/bin/env bash

function main {
  set -exfu

  local mphost="$1"; shift
  local mpserver="$1"; shift
  
  local mpip=
  while [[ -z "${mpip}" ]]; do
    mpip="$(m info --format json $mphost | jq -r --arg mp $mphost '.info[$mp].ipv4[0]')"
  done

  local mpts="$(m info --format json "$mphost" | jq -r --arg mp $mphost '.info[$mp].ipv4[1]')"

  local mpserverip="$(m info --format json $mpserver | jq -r --arg mp $mpserver '.info[$mp].ipv4[0]')"

  bin/join "${mpserverip}" ubuntu "${mpip}" ubuntu
}

main "$@"
