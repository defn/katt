#!/usr/bin/env bash

function main {
  set -exfu

  local mphost="$1"; shift
  local context="$1"; shift

  local mpip=
  while [[ -z "${mpip}" ]]; do
    mpip="$(m info --format json $mphost | jq -r --arg mp $mphost '.info[$mp].ipv4[-1]')"
  done

  local mpts="$(m info --format json "$mphost" | jq -r --arg mp $mphost '.info[$mp].ipv4[-1]')"

  bin/cluster "${mpip}" ubuntu "${context}"
}

main "$@"
